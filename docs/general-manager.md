---
title: 通用调度
description: AUTO_MAA 的通用调度方法
date: 2025-07-16
---

# 通用调度

::: warning 观前须知
通用调度功能有一定的入门门槛，独立完成通用脚本配置，需要您对脚本本身的特性有一定的了解。

若您对需要调度的脚本本体了解不多，可以导入其他用户所写的配置。但请注意，通用调度无法保证能够达到与专项适配后的脚本相同的稳定性，请不要苛责配置的分享者~

如果确定要使用，请认真阅读本文档后再进行提问。
:::

## 调度原理

使用本功能前，您需要了解 **通用调度** 本身的基础工作机制，这能为您后续的故障排查带来许多便利。

### 配置管理逻辑

AUTO_MAA 通过直接保存脚本的配置文件（夹）来实现配置管理，在任务开始前，对应的配置文件将被原样导入脚本的指定位置，任务结束后，不会恢复脚本内原有的配置文件。

### 脚本监看逻辑

AUTO_MAA 通过 **日志文本信息**、**日志时间戳**、**脚本进程是否结束** 指标判定脚本状态，判定逻辑如下：

- 成功：若 **任务成功日志** 已被填写，且 **日志文本信息** 中存在任意 **任务成功日志**，则视为任务成功；若 **任务成功日志** 留空，且在 **脚本进程结束** 时，**日志文本信息** 中不存在任意 **任务异常日志**，则视为任务成功。
- 失败：若最后一条 **日志时间戳** 超出 **自动代理超时限制**，则视为任务因超时失败；若 **任务异常日志** 先于 **任务成功日志** 出现，则视为任务失败；若 **任务成功日志** 已被填写，且在 **脚本进程结束** 时，**日志文本信息** 中不存在任意 **任务成功日志**，则视为任务失败。

## 脚本设置

为了确认程序需要以何种方式调度通用脚本，用户需要准确完成脚本属性的设置，这直接影响到代理的稳定性。

### 脚本根目录

- **类型**：文件夹

- **描述**：这是为了方便用户重新定位脚本程序位置而设立的配置项，当脚本程序位置发生变化时，只需要重新设置根目录，其他路径将自动同步更改。

### 脚本路径

- **类型**：可执行文件

- **描述**：脚本的主程序，无论是配置脚本还是运行任务都需要双击该文件。

- **常见问题**：

    - **程序提示所选路径不在脚本根目录下**：字面意思，请检查脚本根目录设置。
    - **配置脚本或自动代理时无法启动**：自行检查路径与脚本启动参数是否正确，可以在 `debug/AUTO_MAA.log` 中查看具体报错信息。

### 脚本启动参数

- **类型**：由 `|`、`%`和`空格`隔开的若干字符

- **描述**：本配置项仅用于在启动脚本任务时添加附加命令。部分脚本在 UI 界面中没有 `启动后直接运行` 选项，但能够在通过命令行启动时添加对应附加命令来实现该功能。对于这类脚本，您需要设置本项，保证脚本启动后会自动运行任务。

- **设置方法**：查阅脚本软件的对应 **官网/文档站**，找到 **cli运行**、**命令行启动** 或其他类似篇章，获取相关信息后填入，保证使用填入的脚本启动参数时，脚本能够在启动后自动运行任务。若运行脚本任务时使用的附加命令与配置脚本时使用的附加命令不相同，可以将二者同时输入到本配置项，中间以 `|` 分隔。若运行脚本任务时使用的可执行文件与配置脚本时使用的可执行文件不相同，可以在对应的附加命令前输入可执行文件相对于 `脚本路径` 的位置，中间以 `%` 分隔。

- **格式**：`{自动代理可执行文件相对于脚本路径的位置}%{自动代理任务附加命令}|{设置具体配置可执行文件相对于脚本路径的位置}%{设置具体配置任务附加命令}`

### 追踪脚本子进程

- **类型**：开关

- **描述**：用于确认判定 **脚本进程是否结束** 时，是否要考虑脚本的子进程。部分脚本需要通过 **启动器** 打开脚本主程序，脚本主程序启动后，脚本启动器会自动退出，此时不能仅通过 **启动器** 进程是否仍在运行判定整个脚本是否仍在运行。对于此类脚本，需要打开本项。

- **常见问题**：

    - **手动关闭脚本后，程序未能识别到脚本已关闭**：尝试关闭本项。
    - **脚本仍在运行时，程序错误报告脚本已经退出**：尝试打开本项。

### 脚本配置文件路径

- **类型**：任意文件/文件夹

- **描述**：脚本用于存放配置信息的文件/文件夹。

- **设置方法**：打开脚本所在目录，通常会存在一个名为 `config` 的文件/文件夹，此文件/文件夹大概率就是 **脚本配置文件**。

### 脚本日志文件路径

- **类型**：任意文件

- **描述**：脚本用于存放日志信息的文件。

- **设置方法**：打开脚本所在目录，检查是否存在名为 `debug`、`log` 或类似名称的文件夹：
    - 若存在，进入该文件夹，检查是否有文件名中不存在日期信息的文件，如：`log.txt`、`gui.log`：
        - 若存在，则选择对应文件，
        - 若不存在，则选择任意保存有日志信息的文件，这些文件通常具有 `.log`、`.txt` 后缀名，然后设置 **脚本日志文件名格式**。
    - 若不存在，检查脚本根目录是否存在 `.txt`、`.log` 后缀文件，若有，打开确认其内容为脚本日志后，选择该文件。

### 脚本日志文件名格式

- **类型**：用于指示日期时间格式的文本

- **描述**：用于指示实时生成日志文件名的格式。部分脚本软件不会将实时日志写入到一个固定的文件中，而是按照日期，将日志写入不同的文件中。对于此类脚本，用户需要设置日志文件名的格式，以便程序找到实际日志文件位置。

- **设置方法**：复制任意脚本日志文件名到本项中，然后参照 [常见日期时间格式符号对照表](/docs/advanced-features#常见日期时间格式符号对照表) 将文件名中代表日期与时间的元素替换为对应符号，如：`2019-05-01` -> `%Y-%m-%d`。

### 脚本日志时间戳起始/结束位置

- **类型**：数值

- **描述**：用于定位日志文件中每一行日志时间戳的起始与结束位置，便于程序识别时间戳。

- **设置方法**：找到任意一行带有时间戳的日志，从 `1` 开始数，数到时间戳的起始位，此时所数的数值即为起始值，继续数到时间戳结束位，此时所数的数值即为结束值。如：`[2025-06-29 20:00:35.909][INF] <1><> 开始任务`，起始值为 `2`，结束值为 `24`。

### 脚本日志时间格式

- **类型**：用于指示日期时间格式的文本

- **描述**：用于指示日志时间戳的格式，方便程序解析时间戳。

- **设置方法**：复制任意脚本日志时间戳到本项中，然后参照 [常见日期时间格式符号对照表](/docs/advanced-features#常见日期时间格式符号对照表) 将文件名中代表日期与时间的元素替换为对应符号，如：`2019-05-01 16:00:00.000` -> `%Y-%m-%d %H:%M:%S.%f`。

### 脚本成功/失败日志

- **类型**：由 `|` 隔开的若干文本

- **描述**：用于判断脚本运行状态的参考信息，允许设置多条，不同条目以 `|` 分隔。

- **设置方法**：结合自身使用体验与脚本日志文件内容，发挥主观能动性进行定制~

## 配置管理

考虑到通用调度功能有一定的入门门槛，为方便用户快速完成通用脚本设置，通用脚本支持快速导入导出配置。您可以导出配置到 `JSON 文件` 并分享给其他用户，也可以导入其他用户分享的 `JSON 文件`。您甚至可以将您的配置上传到 `「AUTO_MAA 配置分享中心」`，通过审核后即可供所有使用本软件的用户一键导入。

::: warning 注意
- 为防止隐私泄露，脚本根目录将被统一替换为 `C:/脚本根目录`，用户导入配置后须自行重新选择。
- `游戏/模拟器路径` 并不会被统一替换，请自己检查路径中是否可能泄漏个人隐私。
:::

## 下属配置

**下属配置** 与 MAA 脚本中的 **下属用户** 作用相同，每个子配置的运行机制与 MAA 用户配置的详细模式运行机制类似，每个子配置都需要单独进行设置，设置方法与 MAA 配置方法相同。
